define("splunkjs/mvc/datatemplateview",["require","exports","module","underscore","./mvc","./basesplunkview","./messages"],function(e,t,n){var r=e("underscore"),i=e("./mvc"),s=e("./basesplunkview"),o=e("./messages"),u=s.extend({moduleId:n.id,className:"splunk-datatemplateview",options:{managerid:null,data:"preview",template:"",templateName:"",messages:!1},initialize:function(){this.configure(),this.settings.on("change:template change:templateName",this.render,this),this.bindToComponentSetting("managerid",this._onManagerChange,this),this.manager||this._onManagerChange(i.Components,null)},_onManagerChange:function(e,t){this.manager&&(this.manager.off(null,null,this),this.manager=null),this.resultsModel&&(this.resultsModel.off(null,null,this),this.resultsModel.destroy(),this.resultsModel=null);if(!t){this.message("no-search");return}this.message("empty"),this.manager=t,this.resultsModel=t.data(this.settings.get("data"),{output_mode:"json"}),t.on("search:start",this._onSearchStart,this),t.on("search:progress",this._onSearchProgress,this),t.on("search:cancelled",this._onSearchCancelled,this),t.on("search:error",this._onSearchError,this),this.resultsModel.on("data",this.render,this),this.resultsModel.on("error",this._onSearchError,this),t.replayLastSearchEvent(this)},_onSearchCancelled:function(){this._isJobDone=!1,this.message("cancelled",this.$el)},_onSearchProgress:function(e,t){e=e||{};var n=e.content||{},r=n.resultPreviewCount||0,i=this._isJobDone=n.isDone||!1;if(r===0&&i){this.message("no-results",this.$el);return}if(r===0){this.message("waiting",this.$el);return}},_onSearchStart:function(){this._isJobDone=!1,this.message("waiting",this.$el)},_onSearchError:function(e,t){this._isJobDone=!1;var n=e;t&&t.data&&t.data.messages&&t.data.messages.length&&(n=r(t.data.messages).pluck("text").join("; "),this.$el.empty()),this.message({level:"error",icon:"warning-sign",message:n})},message:function(e){this.settings.get("messages")&&o.render(e,this.$el)},render:function(){if(this.resultsModel&&!this.resultsModel.hasData()&&this._isJobDone)return this.message("no-results"),this;if(!this.resultsModel)return this;var e=this.settings.get("template")||"",t=this.settings.get("templateName")||"";!e&&t&&$("#"+t).length>0&&(e=$("#"+t).html());if(!e){this.message({level:"error",icon:"warning-sign",message:"There is no template to render."});return}var n=r.template(e,this.resultsModel.data());return this.$el.html(n),this}});return u});
